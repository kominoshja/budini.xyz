variables:
  JEKYLL_ENV: production

pages:
  image: ruby:2.3
  script:
  - mkdir events projects tech thoughts
  - mv pages/events.html events/index.html
  - mv pages/projects.html projects/index.html
  - mv pages/tech.html tech/index.html
  - mv pages/thoughts.html thoughts/index.html
  - mv blogposts/events/ _events/
  - mv blogposts/projects/ _projects
  - mv blogposts/tech/ _tech
  - mv blogposts/thoughts/ _thoughts
  - cp -R _tech/ _posts
  - cp -R _events/ _posts
  - cp -R _projects/ _posts
  - cp -R _thoughts/ _posts
  - rm -rf pages blogposts
  - bundle install
  - ALGOLIA_API_KEY='bd44fc55419463cd69eb8097450564a4' bundle exec jekyll algolia
  - bundle exec jekyll build -d public
  - sed -i 's/Boris Budini â€“ Boris Budini/Boris Budini/' public/index.html
  - sed -i 's/href=\"https:\/\/boris.budini.xyz\/search\" target=\"_blank\"/href=\"https:\/\/boris.budini.xyz\/search\"/' */*.html
  #to be fixed
  - sed -i '0,/\/images\/Sidebar\/Tech\/router.jpg/{s/\/images\/Sidebar\/Tech\/router.jpg/\/images\/Sidebar\/index.jpg/}' public/index.html
  - sed -i '0,/\/images\/Sidebar\/Tech\/router.jpg/{s/\/images\/Sidebar\/Tech\/router.jpg/\/images\/Sidebar\/404.jpg/}' public/404.html
  - sed -i '0,/\/images\/Sidebar\/Tech\/router.jpg/{s/\/images\/Sidebar\/Tech\/router.jpg/\/images\/Sidebar\/search.jpg/}' public/search.html

  artifacts:
    paths:
    - public
  only:
  - master
